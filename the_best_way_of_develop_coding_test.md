# 最佳实践之项目编码和测试

## 概述
 笔者从事IT软件开发工作以来已经10年了，但是说来惭愧，也就是到了今年个人才感觉项目编码有了一点最佳实践的感觉，借此机会记录下来。一方面，出于自己总结归纳的需要；一方面，也是有机会给后来的年轻人，现身说法，以身作则，介绍代码编写最佳实践的方式和方法。
## 项目开发一般流程
 在读书学习阶段，大家应该都有学些过软件工程，并且书中，提到了各种软件开发方法，传统的瀑布式开发，迭代式开发，螺旋开发，敏捷开发等。但是无论何种开发方式，都还是都包含这几方面的工作：立项，需求分析，实现分析设计，编码&测试，发布&交付&部署。从笔者个人来说，这里的每一步都非常重要，但是鉴于笔者在本篇中，主要介绍编码和测试，有机会，笔者也会介绍下比如需求分析，发布&交付&部署等话题。
## 编码和测试的最佳实践
 这里不废话了，直接提出笔者的最佳实践介绍
### 1.一定要使用github, gitlab或者类似公共或者私有平台。
 笔者从业以来，用过vss, svn, git, hg等工具，但是这里没有任何一种比git，还有支持git的github, gitlab更好用。
### 2.禁止直接push到主干原项目，所有的修改必须fork后走Pull Request.
 说来惭愧，笔者很长一段时间，其实是把github平台当做svn来使用。提交代码，从来就是直接pull后，直接push到项目的master，或者push到dev。都是本地开分支后，合并到master，然后push。我这里只强调，这么做不是最佳实践。
### 3.一定要执行CI（持续集成),如果CI失败，禁止合并到主干
 这里CI要分成2块来说，一个是本地CI，一个是远端CI。在pre-commit前执行本地CI，在push到远端平台后，远端平台再次自动执行CI。
### 4.集成统一的linter
 可以在CI中集成，也可以在pre-commit, pre-push中集成，可能团队成员中因为个人喜好对linter有不同的喜好和习惯，但是没关系，这里最重要的是大家最后使用同一个linter，同一套规范，这个规范可以团队成员讨论，细化，妥协。但是定好以后，大家需要严格执行。
### 5.持续集成中加入所有单元测试
 说来惭愧，因为笔者其实很长段时间，其实不太爱写单元测试，或者单元测试写得少，觉得单元测试枯燥，无聊，代码很low。但是今年以来，我是真正发现了单元测试的好处，最大的好处，就是节约了自己debug的时间。
### 6.设置合理的测试覆盖率目标值
 鉴于开发的语言不同，在实际项目中，覆盖率是很难或者说几乎不可能达到100%覆盖率，但是理论达不到，但是实践中，是可以不断接近的。这里需要设定一个合理的覆盖率，笔者建议最好设置到90%的代码覆盖率，不同项目，可以根据实际情况调整，可以考虑折中85%-95%之间。如果不达标，禁止合并。
### 7.每个PR强制要求必须给出PR的描述信息
 及时是最简单的PR,也必须给出长度合适的描述信息，不能出现诸如“fixed a bug”这种。根据实际项目，给出PR需要提交者，必须注意的提交事项。
### 8.需要合理控制PR的代码行数，涉及文件修改数便于review
 PR的代码行数最好严格控制在100-200行之间。涉及的文件数量，最好不超过10个。根据笔者自己的经验代码行数在100-200之间，文件修改数在10个内，是比较便于review的。超过这个数量，对于reviewer来说，即使结合PR的描述，联系修改的上下文来review也比较吃力了。如果PR修改代码太多，或者修改文件数量太多，大部分reviewer只能做到大概扫一眼，或者相信对方，相信CI了，不会去review test case的代码了。
### 9.代码在测试服务器由专业测试人员测试
 到这里了，但是代码还是不能交付，必须由测试人员再次测试，理由很简单，开发人员不值得信任。我个人就是开发，但是工作长久以来，我都是建议测试人员一定不要相信我，一定要勇敢质疑我，虽然我写了单元测试了，但是单元测试是不是考虑到了所有情况？单元测试是不是写得合理？这里测试人员并不知道，测试人员应该写自己的测试脚本验证。测试不会写脚本？那这里开发人员应该教会测试写脚本。笔者始终觉得，测试不能仅仅就是做个白盒功能测试，随便点点鼠标，键盘输入几个字就行了，还是得写脚本，为什么呢？当然还是节约测试的时间，用脚本跑，避免机械重复的工作。
## 总结
 这里肯定很多读者会质疑，我说的都是纸上谈兵，在实际开发中不可能实现。但是我要说，不要被自己的眼界限制了自己的格局。笔者以前也是持有类似看法，或者长时间不喜欢写测试的习惯，觉得代码测试覆盖率不切实际。但是事实证明我错了，最佳实践是可行的，关键看你们项目愿意去相信最佳实践是否能提高项目质量，提高团队的开发效率。